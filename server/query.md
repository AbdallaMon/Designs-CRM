-- Add isAdmin field
ALTER TABLE `MeetingReminder`
ADD COLUMN `isAdmin` BOOLEAN NOT NULL DEFAULT FALSE;

-- Add optional adminId field
ALTER TABLE `MeetingReminder`
ADD COLUMN `adminId` INT NULL,
ADD INDEX `idx_adminId` (`adminId`),
ADD CONSTRAINT `fk_admin_user` FOREIGN KEY (`adminId`) REFERENCES `User`(`id`) ON DELETE SET NULL;

-- 1. QuestionType
CREATE TABLE QuestionType (
id INT AUTO_INCREMENT PRIMARY KEY,
name VARCHAR(255) UNIQUE NOT NULL,
label VARCHAR(255) NOT NULL,
createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
updatedAt DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 2. BaseQuestion
CREATE TABLE BaseQuestion (
id INT AUTO_INCREMENT PRIMARY KEY,
questionTypeId INT NOT NULL,
title TEXT NOT NULL,
`order` INT DEFAULT 0,
createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
updatedAt DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
FOREIGN KEY (questionTypeId) REFERENCES QuestionType(id) ON DELETE CASCADE
);

-- 3. SessionQuestion
CREATE TABLE SessionQuestion (
id INT AUTO_INCREMENT PRIMARY KEY,
questionTypeId INT NOT NULL,
title TEXT NOT NULL,
isCustom BOOLEAN DEFAULT FALSE,
meetingReminderId INT NOT NULL,
userId INT NULL,
`order` INT DEFAULT 0,
createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
FOREIGN KEY (questionTypeId) REFERENCES QuestionType(id) ON DELETE CASCADE,
FOREIGN KEY (meetingReminderId) REFERENCES MeetingReminder(id) ON DELETE CASCADE,
FOREIGN KEY (userId) REFERENCES User(id) ON DELETE SET NULL
);

-- 4. Answer
CREATE TABLE Answer (
id INT AUTO_INCREMENT PRIMARY KEY,
response TEXT NOT NULL,
sessionQuestionId INT NOT NULL UNIQUE, -- ðŸ‘ˆ Add UNIQUE here
userId INT NOT NULL,
createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,
FOREIGN KEY (sessionQuestionId) REFERENCES SessionQuestion(id) ON DELETE CASCADE,
FOREIGN KEY (userId) REFERENCES User(id) ON DELETE CASCADE
);

ALTER TABLE BaseQuestion
ADD COLUMN isArchived BOOLEAN NOT NULL DEFAULT FALSE;

-- First, create the ENUM type if needed (MySQL stores it per column not globally)
ALTER TABLE MeetingReminder
ADD COLUMN `type` ENUM('SPAIN', 'OBJECTIONS') NULL;
